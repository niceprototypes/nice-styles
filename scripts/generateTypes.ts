/**
 * TypeScript Type Generator
 *
 * Generates TypeScript type definitions from tokens.json
 *
 * ## Purpose
 * Creates union types for all token groups (e.g., FontSizeType, ForegroundColorType)
 * that can be used in TypeScript applications for type-safe token access.
 *
 * ## Input
 * - src/tokens.json: Central token definitions
 *
 * ## Output
 * - dist/types.d.ts: TypeScript type definitions (bypasses TypeScript compiler)
 *
 * ## Example Output
 * export type FontSizeType = "smaller" | "small" | "base" | "large" | "larger"
 * export type ForegroundColorType = "lighter" | "light" | "medium" | "heavy" | "base" | "disabled" | "link" | "success" | "warning" | "error"
 */

import * as fs from 'fs'
import * as path from 'path'
import { fileURLToPath } from 'url'
import { dirname } from 'path'

const __filename = fileURLToPath(import.meta.url)
const __dirname = dirname(__filename)

/**
 * Convert camelCase to PascalCase
 */
function camelToPascal(str: string): string {
  return str.charAt(0).toUpperCase() + str.slice(1)
}

/**
 * Main execution function
 */
function main() {
  const tokensPath = path.join(__dirname, '..', 'src', 'tokens.json')
  const outputPath = path.join(__dirname, '..', 'dist', 'types.d.ts')

  // Ensure dist directory exists
  const outputDir = path.dirname(outputPath)
  if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir, { recursive: true })
  }

  // Read tokens.json
  const tokensContent = fs.readFileSync(tokensPath, 'utf-8')
  const tokens = JSON.parse(tokensContent)

  // Generate type definitions
  const lines: string[] = []
  lines.push('/**')
  lines.push(' * Auto-generated TypeScript type definitions for design tokens')
  lines.push(' *')
  lines.push(' * DO NOT EDIT MANUALLY - Generated by scripts/generateTypes.ts')
  lines.push(' *')
  lines.push(' * To regenerate: npm run build:types')
  lines.push(' */')
  lines.push('')

  // Generate a type for each token group
  for (const tokenName of Object.keys(tokens)) {
    const token = tokens[tokenName]
    const items = Object.keys(token.items)
    const typeName = `${camelToPascal(tokenName)}Type`

    // Create union type from all item keys
    const unionType = items.map(key => `"${key}"`).join(' | ')

    lines.push(`export type ${typeName} = ${unionType}`)
  }

  lines.push('')

  // Write the file
  fs.writeFileSync(outputPath, lines.join('\n'), 'utf-8')
  console.log(`✓ Generated TypeScript types: ${outputPath}`)
  console.log(`✓ Generated ${Object.keys(tokens).length} type definitions`)
}

// Run the main function
main()
